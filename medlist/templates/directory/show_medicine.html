{% extends "base.html" %}
{% load i18n %}
{% load app_filters %}

{% block "extrahead" %}
	<script type="text/javascript" src="{{STATIC_URL}}/js/jquery-ui-1.8.18.custom.min.js"></script>
	<script type="text/javascript" src="{{STATIC_URL}}/js/jquery.easing.js"></script>
	<script type="text/javascript" src="{{STATIC_URL}}/js/jquery.collapse.js"></script>
    
	<link rel="stylesheet" type="text/css" href="{{STATIC_URL}}/css/smoothness/jquery-ui-1.8.18.custom.css" media="screen" />

	<script>
		$(function(){

		})
	</script>
{% endblock %}

{% block "title" %}{{ medicine|translate:request.LANGUAGE_CODE|capfirst }} | {% trans "Medicine" %} | {% endblock %}

{% block "breadcrumb" %}
	
	{{ block.super }} /

	{% if 'section' in request.GET %}	

		<a href="{% url medlist.list.views.show_list id=section.list.id %}" title="{{ section.list.name }}">{{ section.list.name }}</a> /
		{{ medicine|translate:request.LANGUAGE_CODE|capfirst }}

	{% else %}

		<a>{% trans "medicines"|capfirst %}</a> /
		{{ medicine|translate:request.LANGUAGE_CODE|capfirst }}

	{% endif %}
{% endblock %}

{% block "content" %}

	<div class="mainContent">
		<div class="blockTitle">{{ medicine|translate:request.LANGUAGE_CODE|capfirst }}</div>
		<div class="blockSubTitle">{% trans "Pharmaceutical forms" %}</div>
		<script>
		// $(function() {
		// 	$( "#tabs" ).tabs();
		// });

		$(function() {
			$("#tabs").tabs().addClass('ui-tabs-vertical ui-helper-clearfix');
			$("#tabs li").removeClass('ui-corner-top').addClass('ui-corner-left');

			$("#tabs ul li.ui-state-default a").each(function(){
				string = $(this).html().replace(/^\s+|\s+$/g, '');
				title = $(this).attr('title').replace(/^\s+|\s+$/g, '');
				if(string.length < title.length) $(this).html(string + "...");
			});
		});

		</script>
		<div id="tabs">
			<ul>
				<!--  TODO translate -->
				{% for form_id,form in forms.items %}
					<li><a href="#type{{form.form.id}}" title="{{form.form.pharmaceutical_form_type}}">{{form.form.pharmaceutical_form_type|translate:request.LANGUAGE_CODE|slice:"15"}}
					</a></li>	

				{% endfor %}
			</ul>

			{% for form_id,form in forms.items %}
				<div id="type{{form.form.id}}">

					<div class="blockSubTitle">{{ form.form.pharmaceutical_form_type }}</div>

					<div class="highlightBlock">
						<div class="listItemBlock">
							<div class="listItem lists">
								<div class="blockSubTitle l2">{% trans "Lists" %}</div>
								<ul>
									<!-- {{form_id}} -->
									{% for list, forms in forms_in_lists.items %}
										{% if forms.type != 'c' %}
											{% if form_id in forms.forms %}
												<li class="checked"><span>YES</span>
													<a href="{% url list.views.show_list forms.list.id %}" title="{{ forms.list|translate:request.LANGUAGE_CODE }}">
														{{ forms.list|translate:request.LANGUAGE_CODE|slice:"40" }}{% if forms.list|translate:request.LANGUAGE_CODE|length > 40 %}...{% endif %}
													</a>
												</li>
											{% else %}
												<li class="notchecked"><span>NO</span>
													<a href="{% url list.views.show_list forms.list.id %}" title="{{ forms.list|translate:request.LANGUAGE_CODE }}">
														{{ forms.list|translate:request.LANGUAGE_CODE|slice:"40" }}{% if forms.list|translate:request.LANGUAGE_CODE|length > 40 %}...{% endif %}
													</a>
												</li>
											{% endif%}
										{% endif%}
									{% endfor %}
								</ul>
							</div>

							<div class="listItem countries">
								<div class="blockSubTitle">{% trans "Country lists" %}</div>
								<script>
									$(function(){
										var this_class = ".country-{{form.form.id}}";
										var message = "{% trans 'No country medicine list has published this medicine' %}";
										var countries_content = $(this_class).html();

										if(countries_content != null) {
											countries_content = countries_content.replace(/^\s+|\s+$/g,"");
										}

										if(countries_content == "") {
										    $(this_class).html("<i>"+message+".</i>");
									    } else {
									    	last_link = $(this_class + " .country_link:last-child").html();
									    	last_link = last_link.replace(/^\s+|\s+$/g,"").slice(0, -1) + ".";
									    	$(this_class + " .country_link:last-child").html(last_link);
									   }
									});
								</script>
								<div class="countriesContent country-{{form.form.id}}">
									{% for list, forms in forms_in_lists.items %}
										{% if forms.type == 'c' %}
											{% if form_id in forms.forms %}
												<a href="{% url list.views.show_list forms.list.id %}" title="{{ forms.list|translate:request.LANGUAGE_CODE }}" class="country_link">
													{{ forms.list.abbreviation }},
												</a>
											{% endif %}
										{% endif%}
									{% endfor %}
								</div>
							</div>
						</div>

						<div class="topBarGroup">
							<div class="topBarItem">									
								<div class="highlightItem">
									{% if form.form.atc_code %}
										ATC
										<strong>{{ form.form.atc_code }}</strong>
									{% else %}
										ATC
										<strong>N/A</strong>
									{% endif %}
								</div>
							</div>
							<div class="topBarItem">									
								<div class="highlightItem">
									{% if form.form.composition %}
										{% trans "Composition" %}
										<strong>{{ form.form.composition }}</strong>
									{% else %}
										{% trans "Composition" %}
										<strong>N/A</strong>
									{% endif %}
								</div>
							</div>
							<div class="spacer"></div>
						</div>
						<div class="spacer"></div>
					</div>

					<div class="mainBlock obs_lists">

						{% if form.form_in_lists|length > 0 %}
							<div class="blockSubTitle">{% trans "Observations for this pharmaceutical form can be found on the lists:" %}</div>
							
							{% for sf in form.form_in_lists %}

								<strong>{{ sf.section.list|translate:request.LANGUAGE_CODE|capfirst }}</strong><br>
								<em>{{ sf.section|translate:request.LANGUAGE_CODE|capfirst }}</em>

								<ul class="listItems">
									{% if sf.restriction_age %}
										<li>
											<b>{% trans "age or weight restriction"|capfirst %}:</b> {{ sf.restriction_age|capfirst }}<br>
										</li>
									{% endif %}

									{% if sf.only_for_children %}
										<li>
											<b>{% trans "This medicine is only for children."|capfirst %}</b><br>
										</li>
									{% endif %}

									{% if sf.specialist_care_for_children %}
										<li>
											<b>{% trans "This medicine requires a children care specialist."|capfirst %}</b><br>
										</li>
									{% endif %}

									{% if sf.observation %}
										<li>
											<b>{% trans "Others observations"|capfirst %}:</b><br>
											{{sf.html_observation}}
											<br>
										</li>
									{% endif %}
									
									{% if sf.best_evidence %}
										<li>
											<b>{% trans "This medicine has the best evidence for effectiveness and safety."|capfirst %}</b><br>
											<br>
										</li>
									{% endif %}										
									
									{% if not sf.restriction_age and not sf.only_for_children and not  sf.specialist_care_for_children and not sf.observation and not sf.best_evidence %}
										<li><i>{% trans "No observations" %}</i></li>
									{% endif %}
								</ul>
							{% endfor %}
						{% endif %}

					</div>
					<div class="spacer"></div>
				</div>
			{% endfor %}
		</div>

		{% if evidences %}
			<div class="mainBlock evidenceSummary">
				<div class="blockSubTitle">{% trans "Medicine Evidences Summaries" %}</div>
				<ul class="listItems">
					{% for summary in evidences %}			
						<li><a href="{% url evidence.views.show summary.evidence.id %}">{{ summary.evidence.title }}</a></li>
					{% endfor %}
				</ul>
			</div>
		{% endif %}	
		
		<div class="spacer"></div>

	</div>
{% endblock %}